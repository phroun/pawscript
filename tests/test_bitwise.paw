#!/usr/bin/env paw
# Comprehensive test for bitwise module

IMPORT bitwise

echo "=== Bitwise Module Tests ==="
echo ""

# Test 1: Basic AND with int64
echo "Test 1: bitwise_and with integers"
result1: {bitwise_and 0xFF, 0x0F}
echo "0xFF AND 0x0F = ~result1"
echo "(Expected: 15)"
echo ""

# Test 2: Basic OR with int64
echo "Test 2: bitwise_or with integers"
result2: {bitwise_or 0xF0, 0x0F}
echo "0xF0 OR 0x0F = ~result2"
echo "(Expected: 255)"
echo ""

# Test 3: Basic XOR with int64
echo "Test 3: bitwise_xor with integers"
result3: {bitwise_xor 0xFF, 0xAA}
echo "0xFF XOR 0xAA = ~result3"
echo "(Expected: 85)"
echo ""

# Test 4: NOT with int64
echo "Test 4: bitwise_not with integer"
result4: {bitwise_not 0}
echo "NOT 0 = ~result4"
echo "(Expected: -1)"
echo ""

# Test 5: Shift left with int64
echo "Test 5: bitwise_shl with integer"
result5: {bitwise_shl 1, 4}
echo "1 << 4 = ~result5"
echo "(Expected: 16)"
echo ""

# Test 6: Shift right with int64
echo "Test 6: bitwise_shr with integer"
result6: {bitwise_shr 256, 4}
echo "256 >> 4 = ~result6"
echo "(Expected: 16)"
echo ""

# Test 7: Rotate left 8-bit default
echo "Test 7: bitwise_rol 8-bit"
result7: {bitwise_rol 0x81, 1}
echo "0x81 ROL 1 (8-bit) = ~result7"
echo "(Expected: 3, because 10000001 -> 00000011)"
echo ""

# Test 8: Rotate right 8-bit default
echo "Test 8: bitwise_ror 8-bit"
result8: {bitwise_ror 0x81, 1}
echo "0x81 ROR 1 (8-bit) = ~result8"
echo "(Expected: 192, because 10000001 -> 11000000)"
echo ""

# Test 9: Bytes AND operation
echo "Test 9: bitwise_and with bytes"
b1: {bytes 0xFF, 0xAA, 0x55}
b2: {bytes 0x0F, 0x0F, 0x0F}
result9: {bitwise_and ~b1, ~b2}
echo "AND result: ~result9"
echo "(Expected: <0F0A05>)"
echo ""

# Test 10: Bytes OR operation
echo "Test 10: bitwise_or with bytes"
b3: {bytes 0xF0, 0xA0, 0x50}
b4: {bytes 0x0F, 0x0A, 0x05}
result10: {bitwise_or ~b3, ~b4}
echo "OR result: ~result10"
echo "(Expected: <FFAA55>)"
echo ""

# Test 11: Bytes XOR operation
echo "Test 11: bitwise_xor with bytes"
b5: {bytes 0xFF, 0xFF, 0xFF}
b6: {bytes 0xAA, 0x55, 0x00}
result11: {bitwise_xor ~b5, ~b6}
echo "XOR result: ~result11"
echo "(Expected: <55AAFF>)"
echo ""

# Test 12: Bytes NOT operation
echo "Test 12: bitwise_not with bytes"
b7: {bytes 0x00, 0xFF, 0xAA}
result12: {bitwise_not ~b7}
echo "NOT result: ~result12"
echo "(Expected: <FF0055>)"
echo ""

# Test 13: Bytes shift left
echo "Test 13: bitwise_shl with bytes"
b8: {bytes 0x00, 0x01, 0x00}
result13: {bitwise_shl ~b8, 4}
echo "Bytes << 4: ~result13"
echo "(Expected: <001000>)"
echo ""

# Test 14: Bytes shift right
echo "Test 14: bitwise_shr with bytes"
b9: {bytes 0x10, 0x00}
result14: {bitwise_shr ~b9, 4}
echo "Bytes >> 4: ~result14"
echo "(Expected: <0100>)"
echo ""

# Test 15: XOR with repeat (cipher-like)
echo "Test 15: bitwise_xor with repeat"
message: {bytes "HELLO"}
key: {bytes 0x55}
cipher: {bitwise_xor ~message, ~key, repeat: true}
echo "XOR cipher: ~cipher"
decipher: {bitwise_xor ~cipher, ~key, repeat: true}
echo "XOR decipher: ~decipher"
echo "(Expected: reversible cipher)"
echo ""

# Test 16: AND with align left
echo "Test 16: bitwise_and with align left"
long: {bytes 0xFF, 0xFF, 0xFF, 0xFF}
short: {bytes 0x0F, 0x0F}
result16: {bitwise_and ~long, ~short, align: left}
echo "Align left AND: ~result16"
echo "(Expected: <0F0F0000>)"
echo ""

# Test 17: AND with align right (default)
echo "Test 17: bitwise_and with align right"
result17: {bitwise_and ~long, ~short, align: right}
echo "Align right AND: ~result17"
echo "(Expected: <00000F0F>)"
echo ""

# Test 18: List operations
echo "Test 18: bitwise operations on lists"
values: (10, 20, 30)
shifted: {bitwise_shl ~values, 1}
echo "List shifted left: ~shifted"
echo "(Expected: (20, 40, 60))"
echo ""

# Test 19: Rotate with custom bitlength
echo "Test 19: bitwise_rol with bitlength 16"
result19: {bitwise_rol 0x8001, 1, bitlength: 16}
echo "0x8001 ROL 1 (16-bit) = ~result19"
echo "(Expected: 3, because high bit wraps)"
echo ""

# Test 20: Rotate right with custom bitlength
echo "Test 20: bitwise_ror with bitlength 16"
result20: {bitwise_ror 0x8001, 1, bitlength: 16}
echo "0x8001 ROR 1 (16-bit) = ~result20"
echo "(Expected: 49152, 0xC000)"
echo ""

# Test 21: XOR with longer second operand (right align)
echo "Test 21: XOR with longer second operand"
short2: {bytes 0xFF, 0xFF}
long2: {bytes 0x00, 0x00, 0xAA, 0x55}
result21: {bitwise_xor ~short2, ~long2}
echo "Short XOR long: ~result21"
echo "(Expected: <55AA>, takes rightmost portion of longer)"
echo ""

# Test 22: Bytes XOR with int and repeat
echo "Test 22: XOR bytes with int, repeat"
data: {bytes 0x00, 0x00, 0x00, 0x00}
result22: {bitwise_xor ~data, 0xFF, repeat: true}
echo "All zeros XOR 0xFF repeat: ~result22"
echo "(Expected: <FFFFFFFF>)"
echo ""

# Test 23: OR preserves bits in non-overlap
echo "Test 23: OR preserves bits in non-overlap"
base: {bytes 0xAA, 0xBB, 0xCC, 0xDD}
mask: {bytes 0x0F}
result23: {bitwise_or ~base, ~mask}
echo "OR with short mask: ~result23"
echo "(Expected: <AABBCCDF>, only last byte affected)"
echo ""

# Test 24: AND clears bits in non-overlap
echo "Test 24: AND clears bits in non-overlap"
result24: {bitwise_and ~base, ~mask}
echo "AND with short mask: ~result24"
echo "(Expected: <0000000D>, non-overlap cleared)"
echo ""

echo "=== All bitwise tests complete ==="
