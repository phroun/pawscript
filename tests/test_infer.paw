#!/usr/bin/env paw
# Comprehensive test for infer command
# Tests type detection for all 9 types

echo "=== infer Comprehensive Test ==="
echo ""

# Test 1: Integer types
echo "Test 1: Integer types"
infer 42
echo "  42 → {get_result} (expected: int)"

infer -10
echo "  -10 → {get_result} (expected: int)"

infer 0
echo "  0 → {get_result} (expected: int)"
echo ""

# Test 2: Float types
echo "Test 2: Float types"
infer 3.14
echo "  3.14 → {get_result} (expected: float)"

infer -0.5
echo "  -0.5 → {get_result} (expected: float)"

infer 0.0
echo "  0.0 → {get_result} (expected: float)"
echo ""

# Test 3: Boolean types
echo "Test 3: Boolean types"
infer true
echo "  true → {get_result} (expected: bool)"

infer false
echo "  false → {get_result} (expected: bool)"
echo ""

# Test 4: nil type
echo "Test 4: nil type"
infer nil
echo "  nil → {get_result} (expected: nil)"
echo ""

# Test 5: String types (quoted)
echo "Test 5: String types (quoted)"
infer "hello"
echo "  \"hello\" → {get_result} (expected: string)"

infer "world"
echo "  \"world\" → {get_result} (expected: string)"

infer ""
echo "  \"\" (empty) → {get_result} (expected: string)"

infer "42"
echo "  \"42\" (quoted number) → {get_result} (expected: string)"

infer "true"
echo "  \"true\" (quoted bool) → {get_result} (expected: string)"
echo ""

# Test 6: Symbol types (bare identifiers)
echo "Test 6: Symbol types (bare identifiers)"
infer myvar
echo "  myvar → {get_result} (expected: symbol)"

infer identifier
echo "  identifier → {get_result} (expected: symbol)"

infer foo123
echo "  foo123 → {get_result} (expected: symbol)"

infer _underscore
echo "  _underscore → {get_result} (expected: symbol)"
echo ""

# Test 7: Block types (ParenGroup)
echo "Test 7: Block types (ParenGroup)"
infer (echo test)
echo "  (echo test) → {get_result} (expected: block)"

infer (code here)
echo "  (code here) → {get_result} (expected: block)"

infer ()
echo "  () (empty) → {get_result} (expected: block)"
echo ""

# Test 8: Symbol vs String distinction
echo "Test 8: Symbol vs String distinction"
infer admin
echo "  admin (bare) → {get_result} (expected: symbol)"

infer "admin"
echo "  \"admin\" (quoted) → {get_result} (expected: string)"

infer test
echo "  test (bare) → {get_result} (expected: symbol)"

infer "test"
echo "  \"test\" (quoted) → {get_result} (expected: string)"
echo ""

# Test 9: Numbers as different types
echo "Test 9: Numbers as different types"
infer 123
echo "  123 (bare) → {get_result} (expected: int)"

infer "123"
echo "  \"123\" (quoted) → {get_result} (expected: string)"
echo ""

# Test 10: Special string values
echo "Test 10: Special string values"
infer "false"
echo "  \"false\" (string) → {get_result} (expected: string)"

infer "0"
echo "  \"0\" (string) → {get_result} (expected: string)"

infer "nil"
echo "  \"nil\" (string) → {get_result} (expected: string)"
echo ""

# Test 11: Edge cases
echo "Test 11: Edge cases"
infer a
echo "  a (single char) → {get_result} (expected: symbol)"

infer "a"
echo "  \"a\" (quoted single char) → {get_result} (expected: string)"

infer x_y_z
echo "  x_y_z (underscores) → {get_result} (expected: symbol)"

infer CamelCase
echo "  CamelCase → {get_result} (expected: symbol)"
echo ""

# Test 12: Type stability (call multiple times)
echo "Test 12: Type stability"
infer myidentifier
echo "  First call: {get_result}"

infer myidentifier
echo "  Second call: {get_result}"

infer myidentifier
echo "  Third call: {get_result}"
echo "  All should be: symbol"
echo ""

echo "=== Summary ==="
echo ""
echo "Expected type mappings:"
echo "  Bare identifiers (foo, bar) → symbol"
echo "  Quoted text (\"foo\", \"bar\") → string"
echo "  Numbers (42, 3.14) → int or float"
echo "  Booleans (true, false) → bool"
echo "  Null (nil) → nil"
echo "  Blocks ((code)) → block"
echo ""
echo "If all results match expected, infer is working correctly!"
echo ""
echo "=== Test Complete ==="
