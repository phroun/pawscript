#!/usr/bin/env pawscript

echo "=== Test 1: Basic named arguments ==="
basic: {list 1, 2, 3, x: 10}
echo ~basic
echo "Len: {len ~basic}"

echo ""
echo "=== Test 2: Append preserves named args ==="
appended: {append ~basic, 4}
echo ~appended
echo "Len: {len ~appended}"

echo ""
echo "=== Test 3: Prepend preserves named args ==="
prepended: {prepend ~basic, 0}
echo ~prepended
echo "Len: {len ~prepended}"

echo ""
echo "=== Test 4: Slice preserves named args ==="
sliced: {slice ~basic, 0, 2}
echo ~sliced
echo "Len: {len ~sliced}"

echo ""
echo "=== Test 5: Compact preserves named args ==="
compacted: {compact ~basic}
echo ~compacted
echo "Len: {len ~compacted}"

echo ""
echo "=== Test 6: Concat merges named args ==="
list1: {list a, b, x: 1, y: 2}
list2: {list c, d, y: 20, z: 30}
concatenated: {concat ~list1, ~list2}
echo ~concatenated
echo "Len: {len ~concatenated}"

echo ""
echo "=== Test 7: Multiple colons in one list ==="
multi: {list pos1, key1: val1, pos2, key2: val2, pos3}
echo ~multi
echo "Len: {len ~multi}"

echo ""
echo "=== Test 8: Empty list with only named args ==="
named_only: {list x: 100, y: 200}
echo ~named_only
echo "Len: {len ~named_only}"

echo ""
echo "=== Test 9: Quoted keys and values ==="
quoted: {list "name": "John", "age": 30}
echo ~quoted

echo ""
echo "=== Test 10: Numeric and symbol keys ==="
mixed_keys: {list 1: "one", abc: "alphabet"}
echo ~mixed_keys

echo ""
echo "=== Test 11: Tilde resolution in command named args ==="
# Test that tilde expressions in named argument values get resolved
myval: 42
result: {list item, count: ~myval}
echo ~result
echo "count should be 42"

echo ""
echo "=== Test 12: Object reference in named args ==="
# Test that object markers (like list references) work in named args
mylist: {list 1, 2, 3}
# Pass list reference as named argument
result2: {list nested: ~mylist}
echo ~result2

echo ""
echo "=== Test 13: Multiple tilde refs in named args ==="
a: 10
b: 20
# Both named args should resolve
result3: {list x: ~a, y: ~b}
echo ~result3

echo ""
echo "=== Test 14: Dynamic key names ==="
keyName: "dynamic"
keyVal: 99
# Both key and value should resolve
result4: {list ~keyName: ~keyVal}
echo ~result4
echo "Keys:", {keys ~result4}

echo ""
echo "=== Test 15: Dot accessor as key ==="
# Dot accessor on left side of named argument
students: {list firstName: "John", lastName: "Doe"}
result5: {list ~students.firstName: "test"}
echo ~result5
echo "Key should be John"

echo ""
echo "=== Test 16: Space index accessor as key ==="
# Space indexing accessor on left side of named argument
studentNames: {list "Alice", "Bob", "Charlie"}
result6: {list ~studentNames 1: "test"}
echo ~result6
echo "Key should be Bob"
