#!/usr/bin/env paw
# Test nested lists and blocks in lists

echo "=== Nested Lists and Blocks Test ==="
echo ""

# Test 1: Nested lists
echo "Test 1: Nested lists"
inner1: {list a, b, c}
inner2: {list 1, 2, 3}
nested: {list ~inner1, ~inner2, simple}

echo "Nested list length: {len ~nested}"
echo "First item type: {infer {argv ~nested, 1}}"
echo "Second item type: {infer {argv ~nested, 2}}"
echo "Third item type: {infer {argv ~nested, 3}}"
echo "(Expected: 3, list, list, symbol)"
echo ""

# Test 2: Access nested list elements
echo "Test 2: Access nested list elements"
first_inner: {argv ~nested, 1}
echo "First inner list length: {len ~first_inner}"
echo "First element of first inner: {argv ~first_inner, 1}"
echo "(Expected: 3, a)"
echo ""

# Test 3: Direct nested list creation
echo "Test 3: Direct nested list creation"
matrix: {list {list 1, 2}, {list 3, 4}, {list 5, 6}}
echo "Matrix length: {len ~matrix}"
row1: {argv ~matrix, 1}
echo "First row length: {len ~row1}"
echo "Matrix[1][1]: {argv ~row1, 1}"
echo "Matrix[1][2]: {argv ~row1, 2}"
echo "(Expected: 3, 2, 1, 2)"
echo ""

# Test 4: Lists containing blocks (code)
echo "Test 4: Lists containing blocks"
commands: {list (;echo hello), (x: 10;), (;echo world)}
echo "Commands list length: {len ~commands}"
echo "First command type: {infer {argv ~commands, 1}}"
echo "Second command type: {infer {argv ~commands, 2}}"
echo "(Expected: 3, block, block)"
echo ""

# Test 5: Mixed types including lists and blocks
echo "Test 5: Mixed types"
mixed: {list 42, "text", {list nested}, (;code block), true, nil}
echo "Mixed list length: {len ~mixed}"
echo "Item 1 type: {infer {argv ~mixed, 1}}"
echo "Item 2 type: {infer {argv ~mixed, 2}}"
echo "Item 3 type: {infer {argv ~mixed, 3}}"
echo "Item 4 type: {infer {argv ~mixed, 4}}"
echo "Item 5 type: {infer {argv ~mixed, 5}}"
echo "Item 6 type: {infer {argv ~mixed, 6}}"
echo "(Expected: 6, int, string, list, block, bool, nil)"
echo ""

# Test 6: Deeply nested lists
echo "Test 6: Deeply nested (3 levels)"
deep: {list {list {list innermost}}}
echo "Outer length: {len ~deep}"
level2: {argv ~deep, 1}
echo "Level 2 type: {infer ~level2}"
echo "Level 2 length: {len ~level2}"
level3: {argv ~level2, 1}
echo "Level 3 type: {infer ~level3}"
echo "Level 3 length: {len ~level3}"
echo "Innermost value: {argv ~level3, 1}"
echo "(Expected: 1, list, 1, list, 1, innermost)"
echo ""

# Test 7: Building nested structure functionally
echo "Test 7: Building nested structure"
data: {list}
data: {append ~data, {list first, sublist}}
data: {append ~data, {list second, sublist}}
echo "Built nested list length: {len ~data}"
first_sub: {argv ~data, 1}
echo "First sublist: {argv ~first_sub, 1}, {argv ~first_sub, 2}"
echo "(Expected: 2, first, sublist)"
echo ""

# Test 8: List of blocks that could be executed
echo "Test 8: Executable blocks in list"
actions: {list (;echo "Action 1"), (;echo "Action 2"), (;echo "Action 3")}
echo "Actions list length: {len ~actions}"
echo "All items are blocks (type check passed)"
echo ""

# Test 9: Empty nested lists
echo "Test 9: Empty nested lists"
with_empty: {list {list}, {list a}, {list}}
echo "List with empties length: {len ~with_empty}"
first_empty: {argv ~with_empty, 1}
second_item: {argv ~with_empty, 2}
third_empty: {argv ~with_empty, 3}
echo "First (empty) length: {len ~first_empty}"
echo "Second length: {len ~second_item}"
echo "Third (empty) length: {len ~third_empty}"
echo "(Expected: 3, 0, 1, 0)"
echo ""

# Test 10: Slicing nested lists
echo "Test 10: Slicing preserves structure"
big: {list {list a}, {list b}, {list c}, {list d}}
sliced: {slice ~big, 1, 3}
echo "Sliced length: {len ~sliced}"
first_from_slice: {argv ~sliced, 1}
echo "First item type: {infer ~first_from_slice}"
echo "First item content: {argv ~first_from_slice, 1}"
echo "(Expected: 2, list, b)"
echo ""

echo "=== Nested Tests Complete ==="
