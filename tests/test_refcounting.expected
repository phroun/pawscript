=== Reference Counting Test ===

Test 1: Single list reference
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 75 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1         75
Expected: 1 list with refcount=1

Test 2: Multiple variables referencing same list
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 75 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      2         75
Expected: 1 list with refcount=2 (list1 and list2 both reference it)

Test 3: Clear one reference
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 75 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1         75
Expected: 1 list with refcount=1 (only list2 references it)

Test 4: Clear last reference
=== Memory Statistics ===
Total stored objects: 0
Total estimated size: 0 bytes

Expected: 0 lists (freed when last reference cleared)

Test 5: Large string with multiple references
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 296 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
2     string    1         296
Expected: 1 string with refcount=1

Test 6: Copy string reference to another variable
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 296 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
2     string    2         296
Expected: 1 string with refcount=2 (str1 and str2 both reference it)

Test 7: Copy to third variable
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 296 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
2     string    3         296
Expected: 1 string with refcount=3 (str1, str2, str3 all reference it)

Test 8: Clear middle reference
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 296 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
2     string    2         296
Expected: 1 string with refcount=2 (str1 and str3 still reference it)

Test 9: Clear remaining references
=== Memory Statistics ===
Total stored objects: 0
Total estimated size: 0 bytes

Expected: 0 objects (string freed)

Test 10: Large block with multiple references
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 572 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
3     block     1         572
Expected: 1 block with refcount=1

Test 11: Share block across variables
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 572 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
3     block     3         572
Expected: 1 block with refcount=3 (block1, block2, block3)

Test 12: Clear all block references
=== Memory Statistics ===
Total stored objects: 0
Total estimated size: 0 bytes

Expected: 0 objects (block freed)

Test 13: Nested list with shared inner list
=== Memory Statistics ===
Total stored objects: 3
Total estimated size: 221 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
4     list      3         75
5     list      1         73
6     list      1         73
Expected: 3 lists - inner (refcount=3), outer1 (refcount=1), outer2 (refcount=1)

Test 14: Clear outer lists but keep inner
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 75 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
4     list      1         75
Expected: 1 list (inner) with refcount=1

Test 15: Clear inner list
=== Memory Statistics ===
Total stored objects: 0
Total estimated size: 0 bytes

Expected: 0 lists

Test 16: List in result with refcount
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 44 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
7     list      2         44
Expected: 1 list with refcount=2 (mylist variable + result)

Test 17: Clear variable, result still holds reference
=== Memory Statistics ===
Total stored objects: 1
Total estimated size: 44 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
7     list      1         44
Expected: 1 list with refcount=1 (only result)

Test 18: Clear result
=== Memory Statistics ===
Total stored objects: 0
Total estimated size: 0 bytes

Expected: 0 lists

=== Test Complete ===
