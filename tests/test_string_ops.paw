#!/usr/bin/env paw
# Test string manipulation functions

echo "=== STRING MANIPULATION TESTS ==="
print

# ==========================================
# str_concat - concatenate strings
# ==========================================
echo "Testing str_concat..."
set result, {str_concat "hello", " ", "world"}
echo "str_concat result: {get result}"
echo "Expected: hello world"

set multi, {str_concat "a", "b", "c", "d", "e"}
echo "Multi-concat: {get multi}"
echo "Expected: abcde"
print

# ==========================================
# split and join - inverse operations
# ==========================================
echo "Testing split..."
set parts, {split "a,b,c,d", ","}
echo "Split result length: {len {get parts}}"
echo "Expected: 4"
echo "First item: {argv {get parts}, 1}"
echo "Expected: a"
echo "Last item: {argv {get parts}, 4}"
echo "Expected: d"
print

echo "Testing join..."
set joined, {join {get parts}, "-"}
echo "Join result: {get joined}"
echo "Expected: a-b-c-d"
print

# Test split/join round-trip
set original, "one|two|three"
set rejoined, {join {split {get original}, "|"}, "|"}
echo "Round-trip test: {get rejoined}"
echo "Expected: one|two|three"
print

# ==========================================
# str_upper and str_lower - case conversion
# ==========================================
echo "Testing str_upper..."
set upper, {str_upper "hello world"}
echo "Uppercase: {get upper}"
echo "Expected: HELLO WORLD"
print

echo "Testing str_lower..."
set lower, {str_lower "HELLO WORLD"}
echo "Lowercase: {get lower}"
echo "Expected: hello world"
print

# ==========================================
# trim functions - whitespace removal
# ==========================================
echo "Testing trim..."
set trimmed, {trim "  hello world  "}
echo "Trimmed: [{get trimmed}]"
echo "Expected: [hello world]"
print

echo "Testing trim_left..."
set input, "  hello world  "
set left, {trim_left {get input}}
# Verify it starts with "hello" (no leading spaces)
if {starts_with {get left}, "hello"} then (
    echo "Left trimmed correctly - starts with hello"
) else (
    echo "Left trim FAILED"
)
echo "Expected: Left trimmed correctly - starts with hello"
print

echo "Testing trim_right..."
set right, {trim_right "  hello world  "}
echo "Right trimmed: [{get right}]"
echo "Expected: [  hello world]"
print

# ==========================================
# contains - substring checking
# ==========================================
echo "Testing contains..."
if {contains "hello world", "world"} then (
    echo "Contains 'world': true"
) else (
    echo "Contains 'world': false"
)
echo "Expected: true"

if {contains "hello world", "xyz"} then (
    echo "Contains 'xyz': true"
) else (
    echo "Contains 'xyz': false"
)
echo "Expected: false"
print

# ==========================================
# index - finding substrings
# ==========================================
echo "Testing index..."
set idx1, {index "hello world", "world"}
echo "Index of 'world': {get idx1}"
echo "Expected: 6"

set idx2, {index "hello world", "xyz"}
echo "Index of 'xyz': {get idx2}"
echo "Expected: -1"
print

# ==========================================
# replace - replacing substrings
# ==========================================
echo "Testing replace..."
set replaced, {replace "hello world world", "world", "gopher"}
echo "Replaced: {get replaced}"
echo "Expected: hello gopher gopher"

set no_replace, {replace "hello", "xyz", "abc"}
echo "No match replace: {get no_replace}"
echo "Expected: hello"
print

# ==========================================
# starts_with and ends_with
# ==========================================
echo "Testing starts_with..."
if {starts_with "hello world", "hello"} then (
    echo "Starts with 'hello': true"
) else (
    echo "Starts with 'hello': false"
)
echo "Expected: true"

if {starts_with "hello world", "world"} then (
    echo "Starts with 'world': true"
) else (
    echo "Starts with 'world': false"
)
echo "Expected: false"
print

echo "Testing ends_with..."
if {ends_with "hello world", "world"} then (
    echo "Ends with 'world': true"
) else (
    echo "Ends with 'world': false"
)
echo "Expected: true"

if {ends_with "hello world", "hello"} then (
    echo "Ends with 'hello': true"
) else (
    echo "Ends with 'hello': false"
)
echo "Expected: false"
print

# ==========================================
# str_rrepeat - repeating strings
# ==========================================
echo "Testing str_repeat..."
set repeated, {str_repeat "ab", 3}
echo "Repeated: {get repeated}"
echo "Expected: ababab"

set single, {str_repeat "x", 1}
echo "Single repeat: {get single}"
echo "Expected: x"

set none, {str_repeat "y", 0}
set none_len, {len {get none}}
echo "Zero repeat length: {get none_len}"
echo "Expected: 0"
print

# ==========================================
# Combining with slice (already works on strings)
# ==========================================
echo "Testing str_concat with slice..."
set text, "hello world"
set first_five, {slice {get text}, 0, 5}
set last_five, {slice {get text}, 6, -1}
set combined, {str_concat {get first_five}, " + ", {get last_five}}
echo "Combined: {get combined}"
echo "Expected: hello + world"
print

# ==========================================
# Combining with len (already works on strings)
# ==========================================
echo "Testing str operations with len..."
set str, "hello"
set length, {len {get str}}
echo "Length of 'hello': {get length}"
echo "Expected: 5"

set empty, ""
set empty_len, {len {get empty}}
echo "Length of empty string: {get empty_len}"
echo "Expected: 0"
print

# ==========================================
# Practical example: CSV-like parsing
# ==========================================
echo "Practical example: CSV parsing..."
set csv_line, "John Doe,30,Engineer"
set fields, {split {get csv_line}, ","}
set name, {argv {get fields}, 1}
set age, {argv {get fields}, 2}
set job, {argv {get fields}, 3}

echo "Name: {get name}"
echo "Age: {get age}"
echo "Job: {get job}"
echo "Expected: Name: John Doe, Age: 30, Job: Engineer"
print

# ==========================================
# Practical example: Text formatting
# ==========================================
echo "Practical example: Text formatting..."
set raw, "  HELLO WORLD  "
set trimmed, {trim {get raw}}
echo "Trimmed: [{get trimmed}]"
echo "Expected: [HELLO WORLD]"

set formatted, {str_lower {get trimmed}}
echo "Lowercased: [{get formatted}]"
echo "Expected: [hello world]"

set upper_version, {str_upper {get formatted}}
echo "Back to upper: [{get upper_version}]"
echo "Expected: [HELLO WORLD]"
print

# ==========================================
# Practical example: Path manipulation
# ==========================================
echo "Practical example: Path manipulation..."
set path, "/home/user/documents/file.txt"
set parts, {split {get path}, "/"}
set filename, {argv {get parts}, {len {get parts}}}
echo "Filename: {get filename}"
echo "Expected: file.txt"

if {ends_with {get filename}, ".txt"} then (
    echo "Is a text file: true"
) else (
    echo "Is a text file: false"
)
echo "Expected: true"
print

echo "=== ALL STRING TESTS COMPLETE ==="
