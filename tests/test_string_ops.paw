#!/usr/bin/env paw
# Test string manipulation functions

echo "=== STRING MANIPULATION TESTS ==="
print

# ==========================================
# concat - concatenate strings
# ==========================================
echo "Testing concat..."
result: {concat "hello", " ", "world"}
echo "concat result: ~result"
echo "Expected: hello world"

multi: {concat "a", "b", "c", "d", "e"}
echo "Multi-concat: ~multi"
echo "Expected: abcde"
print

# ==========================================
# split and join - inverse operations
# ==========================================
echo "Testing split..."
parts: {split "a,b,c,d", ","}
echo "Split result length: {len ~parts}"
echo "Expected: 4"
echo "First item: {argv ~parts, 1}"
echo "Expected: a"
echo "Last item: {argv ~parts, 4}"
echo "Expected: d"
print

echo "Testing join..."
joined: {join ~parts, "-"}
echo "Join result: ~joined"
echo "Expected: a-b-c-d"
print

# Test split/join round-trip
original: "one|two|three"
rejoined: {join {split ~original, "|"}, "|"}
echo "Round-trip test: ~rejoined"
echo "Expected: one|two|three"
print

# ==========================================
# upper and lower - case conversion
# ==========================================
echo "Testing upper..."
upper: {upper "hello world"}
echo "Uppercase: ~upper"
echo "Expected: HELLO WORLD"
print

echo "Testing lower..."
lower: {lower "HELLO WORLD"}
echo "Lowercase: ~lower"
echo "Expected: hello world"
print

# ==========================================
# trim functions - whitespace removal
# ==========================================
echo "Testing trim..."
trimmed: {trim "  hello world  "}
echo "Trimmed: [~trimmed]"
echo "Expected: [hello world]"
print

echo "Testing trim_start..."
input: "  hello world  "
start: {trim_start ~input}
# Verify it starts with "hello" (no leading spaces)
if {starts_with ~start, "hello"} then (
    echo "Start trimmed correctly - starts with hello"
) else (
    echo "Start trim FAILED"
)
echo "Expected: Start trimmed correctly - starts with hello"
print

echo "Testing trim_end..."
end: {trim_end "  hello world  "}
echo "End trimmed: [~end]"
echo "Expected: [  hello world]"
print

# ==========================================
# contains - substring checking
# ==========================================
echo "Testing contains..."
if {contains "hello world", "world"} then (
    echo "Contains 'world': true"
) else (
    echo "Contains 'world': false"
)
echo "Expected: true"

if {contains "hello world", "xyz"} then (
    echo "Contains 'xyz': true"
) else (
    echo "Contains 'xyz': false"
)
echo "Expected: false"
print

# ==========================================
# index - finding substrings
# ==========================================
echo "Testing index..."
idx1: {index "hello world", "world"}
echo "Index of 'world': ~idx1"
echo "Expected: 6"

idx2: {index "hello world", "xyz"}
echo "Index of 'xyz': ~idx2"
echo "Expected: -1"
print

# ==========================================
# replace - replacing substrings
# ==========================================
echo "Testing replace..."
replaced: {replace "hello world world", "world", "gopher"}
echo "Replaced: ~replaced"
echo "Expected: hello gopher gopher"

no_replace: {replace "hello", "xyz", "abc"}
echo "No match replace: ~no_replace"
echo "Expected: hello"
print

# ==========================================
# starts_with and ends_with
# ==========================================
echo "Testing starts_with..."
if {starts_with "hello world", "hello"} then (
    echo "Starts with 'hello': true"
) else (
    echo "Starts with 'hello': false"
)
echo "Expected: true"

if {starts_with "hello world", "world"} then (
    echo "Starts with 'world': true"
) else (
    echo "Starts with 'world': false"
)
echo "Expected: false"
print

echo "Testing ends_with..."
if {ends_with "hello world", "world"} then (
    echo "Ends with 'world': true"
) else (
    echo "Ends with 'world': false"
)
echo "Expected: true"

if {ends_with "hello world", "hello"} then (
    echo "Ends with 'hello': true"
) else (
    echo "Ends with 'hello': false"
)
echo "Expected: false"
print

# ==========================================
# repeat - repeating strings
# ==========================================
echo "Testing repeat..."
repeated: {repeat "ab", 3}
echo "Repeated: ~repeated"
echo "Expected: ababab"

single: {repeat "x", 1}
echo "Single repeat: ~single"
echo "Expected: x"

none: {repeat "y", 0}
none_len: {len ~none}
echo "Zero repeat length: ~none_len"
echo "Expected: 0"
print

# ==========================================
# Combining with slice (already works on strings)
# ==========================================
echo "Testing concat with slice..."
text: "hello world"
first_five: {slice ~text, 0, 5}
last_five: {slice ~text, 6, -1}
combined: {concat ~first_five, " + ", ~last_five}
echo "Combined: ~combined"
echo "Expected: hello + world"
print

# ==========================================
# Combining with len (already works on strings)
# ==========================================
echo "Testing str operations with len..."
str: "hello"
length: {len ~str}
echo "Length of 'hello': ~length"
echo "Expected: 5"

empty: ""
empty_len: {len ~empty}
echo "Length of empty string: ~empty_len"
echo "Expected: 0"
print

# ==========================================
# Practical example: CSV-like parsing
# ==========================================
echo "Practical example: CSV parsing..."
csv_line: "John Doe,30,Engineer"
fields: {split ~csv_line, ","}
name: {argv ~fields, 1}
age: {argv ~fields, 2}
job: {argv ~fields, 3}

echo "Name: ~name"
echo "Age: ~age"
echo "Job: ~job"
echo "Expected: Name: John Doe, Age: 30, Job: Engineer"
print

# ==========================================
# Practical example: Text formatting
# ==========================================
echo "Practical example: Text formatting..."
raw: "  HELLO WORLD  "
trimmed: {trim ~raw}
echo "Trimmed: [~trimmed]"
echo "Expected: [HELLO WORLD]"

formatted: {lower ~trimmed}
echo "Lowercased: [~formatted]"
echo "Expected: [hello world]"

upper_version: {upper ~formatted}
echo "Back to upper: [~upper_version]"
echo "Expected: [HELLO WORLD]"
print

# ==========================================
# Practical example: Path manipulation
# ==========================================
echo "Practical example: Path manipulation..."
path: "/home/user/documents/file.txt"
parts: {split ~path, "/"}
filename: {argv ~parts, {len ~parts}}
echo "Filename: ~filename"
echo "Expected: file.txt"

if {ends_with ~filename, ".txt"} then (
    echo "Is a text file: true"
) else (
    echo "Is a text file: false"
)
echo "Expected: true"
print

echo "=== ALL STRING TESTS COMPLETE ==="
