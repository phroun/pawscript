=== String Operations Reference Counting Test ===

Test 1: Initial state
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 616 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
7     string    1         232
Expected: 0 objects

Test 2: upper with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 0 objects (small string stays inline)

Test 3: upper with large string
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 616 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
8     string    2         232
Expected: 2 objects (large_base + large_upper)

Test 4: Clear upper results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 5: lower with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 6: lower with large string
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 616 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
9     string    2         232
Expected: 2 objects (large_base + large_lower)

Test 7: Clear lower results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 8: trim with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 9: trim with large string
=== Memory Statistics ===
Total stored objects: 8
Total estimated size: 854 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
10    string    1         238
12    string    2         232
Expected: 3 objects (large_base + padded_large + large_trim)

Test 10: Clear trim results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 11: trim_start with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 12: Clear trim_start result
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 13: trim_end with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 14: Clear trim_end result
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 15: replace with small string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 16: replace with large string
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 616 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
13    string    2         232
Expected: 2 objects (large_base + large_replace)

Test 17: Clear replace results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 18: repeat small result
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 19: repeat large result
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 650 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
14    string    2         266
Expected: 2 objects (large_base + large_repeat of 250 chars)

Test 20: Clear repeat results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 21: slice small result from large string
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base, slice is small)

Test 22: slice large result from large string
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 605 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
15    string    2         221
Expected: 2 objects (large_base + large_slice)

Test 23: Clear slice results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 24: join small result
=== Memory Statistics ===
Total stored objects: 7
Total estimated size: 459 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
16    list      1         75
Expected: 2 objects (large_base + items list)

Test 25: join large result
=== Memory Statistics ===
Total stored objects: 9
Total estimated size: 998 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    3         232
16    list      1         75
17    list      1         88
18    string    2         451
Expected: 4 objects (large_base + items + big_items + large_join)

Test 26: Clear join results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 27: exec with small output
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (large_base)

Test 28: exec with large output
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 2 objects (large_base + large_exec)

Test 29: Clear exec results
=== Memory Statistics ===
Total stored objects: 6
Total estimated size: 384 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
6     string    1         232
Expected: 1 object (only large_base)

Test 30: Clear large_base
=== Memory Statistics ===
Total stored objects: 5
Total estimated size: 152 bytes

ID    Type      RefCount  Size(bytes)
----  --------  --------  -----------
1     list      1000000   24
2     channel   0         32
3     channel   0         32
4     channel   0         32
5     channel   0         32
Expected: 0 objects (all freed)

=== Test Complete ===
