#!/usr/bin/env paw
# Test QuotedString and ParenGroup handling in toBool and toNumber

echo "=== QuotedString and ParenGroup Type Handling ==="
echo ""

# Test 1: QuotedString truthiness
echo "Test 1: QuotedString truthiness"
str_false: "false"
if ~str_false then (
    echo "FAIL: \"false\" should be falsy"
) else (
    echo "PASS: \"false\" is falsy"
)

str_zero: "0"
if ~str_zero then (
    echo "FAIL: \"0\" should be falsy"
) else (
    echo "PASS: \"0\" is falsy"
)

str_true: "hello"
if ~str_true then (
    echo "PASS: \"hello\" is truthy"
) else (
    echo "FAIL: \"hello\" should be truthy"
)
echo ""

# Test 2: QuotedString in arithmetic
echo "Test 2: QuotedString in arithmetic"
num_str: "123"
result: {add ~num_str, 10}
if {eq ~result, 133} then (
    echo "PASS: add \"123\", 10 = 133"
) else (
    echo "FAIL: add \"123\", 10 = ~result (expected 133)"
)
echo ""

# Test 3: Symbol truthiness
echo "Test 3: Symbol truthiness"
sym_val: myidentifier
if ~sym_val then (
    echo "PASS: symbol is truthy"
) else (
    echo "FAIL: symbol should be truthy"
)
echo ""

# Test 4: Symbol in arithmetic
echo "Test 4: Symbol in arithmetic (numeric symbol)"
num_sym: 456
result2: {add ~num_sym, 100}
if {eq ~result2, 556} then (
    echo "PASS: add 456, 100 = 556"
) else (
    echo "FAIL: add 456, 100 = ~result2 (expected 556)"
)
echo ""

# Test 5: ParenGroup truthiness
echo "Test 5: ParenGroup truthiness"
code_block: (echo test)
if ~code_block then (
    echo "PASS: non-empty ParenGroup is truthy"
) else (
    echo "FAIL: non-empty ParenGroup should be truthy"
)
echo ""

# Test 6: Type comparisons
echo "Test 6: Type checking"
x: "text"
y: symbol
z: (block)

echo "\"text\" type: {get_type x}"
echo "symbol type: {get_type y}"
echo "(block) type: {get_type z}"
echo ""

# Test 7: Edge case - string "false" vs bool false
echo "Test 7: String \"false\" vs bool false"
bool_false: false
str_false2: "false"

if ~bool_false then (
    echo "FAIL: bool false should be falsy"
) else (
    echo "PASS: bool false is falsy"
)

if ~str_false2 then (
    echo "FAIL: string \"false\" should be falsy"
) else (
    echo "PASS: string \"false\" is falsy"
)
echo ""

# Test 8: Comparison operations with different types
echo "Test 8: Comparisons across types"
num_as_str: "42"
num_as_int: 42

if {eq ~num_as_str, ~num_as_int} then (
    echo "PASS: \"42\" equals 42 (string coercion)"
) else (
    echo "FAIL: \"42\" should equal 42"
)
echo ""

echo "=== All Edge Case Tests Complete ==="
