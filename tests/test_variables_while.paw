# !/usr/bin/env paw

echo "=== Testing Variables, Parenthesis Blocks, and While Loops ==="
echo ""

# Test 1: Basic variable set and get
echo "Test 1: Basic variables"
name: "Alice"
age: 30
age: {add ~age, 1}
gt ~age, 30
then {
   echo "Alice is old!"
}
lt ~age, 20
then {
   echo "Alice is too young."
} else {
   echo "But, she's fine"
}
echo "Name: ~name"
echo "Age: ~age"
echo ""

# Test 2: Parenthesis blocks share scope
echo "Test 2: Parenthesis blocks (same scope)"
counter: 0
(
    counter: 5;
    echo "Inside block, counter = ~counter"
)
echo "Outside block, counter = ~counter"
echo "Expected: counter should be 5 both inside and outside"
echo ""

# Test 3: Variables in brace expressions (same scope now)
echo "Test 3: Braces and variables"
x: 10
doubled: {
    temp: {mul ~x, 2};
    ret ~temp
}
echo "x = ~x"
echo "doubled = ~doubled"
echo "temp = ~temp"
echo "Expected: x=10, doubled=20, temp=20 (all accessible)"
echo ""

# Test 4: While loop basic
echo "Test 4: Basic while loop"
i: 0
while (lt ~i, 5), (
    echo "  Loop iteration ~i";
    i: {add ~i, 1}
)
echo "After loop, i = ~i"
echo "Expected: printed 0,1,2,3,4 and i=5"
echo ""

# Test 5: While loop result value
echo "Test 5: While loop result value"
count: 0
set_result "initial"
while (lt ~count, 3), (
    count: {add ~count, 1};
    set_result ~count
)
echo "Result after while: {get_result}"
echo "Expected: 3"
echo ""

# Test 6: While loop that never executes
echo "Test 6: While loop that doesn't execute"
set_result "before"
while false, (
    set_result "inside"
)
echo "Result: {get_result}"
echo "Expected: 'before' (never touched)"
echo ""

# Test 7: Nested while loops
echo "Test 7: Nested while loops"
outer: 0
while (lt ~outer, 3), (
    inner: 0;
    while (lt ~inner, 2), (
        echo "  outer=~outer, inner=~inner";
        inner: {add ~inner, 1}
    );
    outer: {add ~outer, 1}
)
echo "Expected: outer 0,1,2 each with inner 0,1"
echo ""

echo "=== All Tests Complete ==="
